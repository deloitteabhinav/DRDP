<apex:page docType="html-5.0" sidebar="false" showHeader="false" standardStylesheets="false" controller="ActivitiesList"  readonly="true" id="thePage">
    <script type='text/javascript'>
        function isValidSearchString(searchString) {
            var SEARCH_TRIGGER_THRESHOLD = 2;
            var trimmedSearchString = searchString.trim();

                if (trimmedSearchString.length >= SEARCH_TRIGGER_THRESHOLD) {
                    return true;
                } else {
                    return false;
                }
        }
        
        function noenter(ev)  {
            if (window.event && window.event.keyCode == 13 || ev.which == 13) {
                var searchString = (document.getElementsByClassName("keyword_Study_Search_Text"))[0].value;
                if (isValidSearchString(searchString)){
                    doSearchAf();
                }
                return false;
             } else {
                  return true;
             }
         }
    </script>   
  
    <title>Research</title>

    <c:DRDP_IndexNew />


        <div class='content'>
        
        <apex:form id="theForm">

        <apex:actionFunction name="doSearchAf" action="{!FetchDataForCriteria}" oncomplete="drdw.listView.handlerSeeMoreFilters();" rerender="PaginationPanel,therapueticareaCol,resultsize" />
        <apex:actionFunction name="toggleflagoff" action="{!toggleOff}" oncomplete="drdw.listView.handlerSeeMoreFilters();" rerender="PaginationPanel,therapueticareaCol,resultsize" />
        <apex:actionFunction name="toggleflagoff2" action="{!toggleOff2}" oncomplete="drdw.listView.handlerSeeMoreFilters();" rerender="PaginationPanel,therapueticareaCol,resultsize" />

            <div class='fixed-container list-view'>

                <div class='filters-wrapper'>

                    <!--The below page logic will display the total number of studies per filter-->
                    <div class="filter-header container">
                        <apex:outputpanel id="resultsize">
                            <span class='result-count'>{!cProjectListCntlr.ResultSize} Activities</span>
                        </apex:outputpanel>
                        <!-- <apex:outputlink value="/apex/PlanActivity" styleClass="create-new enabled l-blue hidden-xs">Plan Activity​</apex:outputlink> -->
                        <apex:outputlink value="/a1m/e?retURL=%2Fa1m%2Fo" styleClass="create-new enabled l-gold-2 hidden-xs">Plan Activity​</apex:outputlink>  

                        <span class='icon-large-caret down'></span>
                    </div>

                    <!--The below page logic will display the check box filters for various fields and the pivot-->
                    <div class='filter-container container'>

                        <!--Start of Output Panel-->
                        <apex:outputpanel id="therapueticareaCol">

                            
                            <!-- STUDY TYPE field filter checkboxes -->
                            
                           <div class='pivot-container col-md-12'>
                                <span class='label'>{!ActivityStatus.size - 1} Status</span>
                                <label>
                                    <apex:selectList multiselect="false" size="1" value="{!sStudyStatus}">
                                        <apex:actionSupport event="onchange" action="{!FetchDataForCriteria}" rerender="PaginationPanel,therapueticareaCol,resultsize" oncomplete="drdw.listViewComparo.handlers();drdw.listView.handlerSeeMoreFilters();"  />
                                        <apex:selectOptions value="{!ActivityStatus}" />
                                    </apex:selectList>
                                </label>
                            </div>
                            
                            <!--End of Output Panel-->
                        </apex:outputpanel>
                    </div>

                </div>
                

                <!--Below page logic contains local search Bar-->
                <div class='type-ahead-search-wrapper container'>
                    <span class='icon-find'></span>
                    <apex:inputtext value="{!sSearchWord}" html-placeholder="Search Activities" onkeypress="return noenter(event);" styleClass="keyword_Study_Search_Text"/>
                    <!--<button class='create-new l-blue' disabled="disabled" onclick="doSearchAf()" >Go</button>-->
                    <apex:commandButton Value="Go" action="{!FetchDataForCriteria}" Styleclass="button create-new l-gold-2" disabled="false"  oncomplete="drdw.listView.handlerSeeMoreFilters();" rerender="PaginationPanel,therapueticareaCol,resultsize"/>
                    <apex:outputlink value="/apex/ActivitiesList" StyleClass="filter-reset">Clear All</apex:outputlink>
                </div>
                
                <!--Start of Output Panel which contains Results after filter search-->
                <apex:outputpanel id="Listcontent">

                    <!--Results container HTML-->
                    <div class='results-header container l-gold-2'>

                        <!--Name column of the results displayed-->
                        <div class='result-header-item col-md-3 sort-by'>
                            <apex:commandlink value="Title" action="{!sort}" rerender="Listcontent,PaginationPanel">
                                <apex:param name="Name" value="Name" assignTo="{!sField}" />
                            </apex:commandlink>
                            <apex:outputText styleclass="{!IF(contains(sOrder,"ASC"),"icon-arrow up","icon-arrow down")}" rendered="{!sField='Name'}"/>
                        </div>
                        <!--Parent Project ID column of the results displayed-->
                        <div class='result-header-item col-md-2 sort-by'>
                          Parent Project
                        </div>                        
                                                                                                  
                        <div class='result-header-item col-md-2 hidden-xs'>
                            Start Date
                        </div>

                        <div class='result-header-item col-md-2 hidden-xs'>
                            End Date
                        </div>

                        <div class='result-header-item col-md-2 sort-by hidden-xs'>
                            Status
                        </div>

                    </div>

                    <!--End of Output Panel which contains Results after filter search-->
                </apex:outputpanel>

            </div>

            <!--Start of div for pagination-->
            <div class='results-wrapper'>

                <apex:outputpanel id="PaginationPanel">

                    <div class='results container'>
                        <apex:repeat value="{!Studies}" var="OStudy">
                            <div class='result-item col-md-12'>

                                <div class='col-md-3'>
                                    <!--<apex:outputLink value="{!If(OStudy.Classification__c == 'Research Topic','/apex/research_topics?id='+OStudy.Id,'/apex/CreateStudy?id='+OStudy.Id)}" target="_blank">{!OStudy.Name}</apex:outputLink> --> 
                                    <apex:outputLink value="{!If(OStudy.Id == 'Research Topic','/'+OStudy.Id,'/'+ OStudy.Id)}" target="_blank">{!OStudy.Name}</apex:outputLink>  
                                </div>
                                <div class='col-md-2'>
                                    <apex:outputText value="{0}">
                                        <apex:param value="{!OStudy.Parent_Project__r.name}"/>
                                    </apex:outputText>
                                </div>
                                <div class='col-md-2 hidden-xs'>
                                   <!--  {!OStudy.Start_Date__c} -->
                                   <apex:outputText value="{0,date,MMM-dd-yyyy}">
                                      <apex:param value="{!OStudy.Start_Date__c}"/>
                                   </apex:outputText>
                                </div>
                                <div class='col-md-2 hidden-xs'>
                                   <!-- {!OStudy.End_Date__c}  -->
                                   <apex:outputText value="{0,date,MMM-dd-yyyy}">
                                      <apex:param value="{!OStudy.End_Date__c}"/>
                                   </apex:outputText>
                                
                                </div>
                                
                                <div class='col-md-3 hidden-xs'>
                                 <!-- {!mTeamMembers[OStudy.Id]}  -->
                                 {!OStudy.Status__c}
                                </div>
                            </div>
                        </apex:repeat>
                    </div>
                    
                    <apex:outputPanel rendered="{!cProjectListCntlr.ResultSize>0}">
                    <div class='pagination container'>                    
                        <span class='col-md-12'>Displaying {!((cProjectListCntlr.pagenumber-1)*cProjectListCntlr.pagesize)+1}-{!IF(cProjectListCntlr.ResultSize < ((cProjectListCntlr.pagenumber)*cProjectListCntlr.pagesize),cProjectListCntlr.ResultSize,((cProjectListCntlr.pagenumber)*cProjectListCntlr.pagesize))} of {!cProjectListCntlr.ResultSize}</span>
                        <div class='indicator-container col-md-12'>
                            <apex:actionregion >
                                <apex:commandlink styleClass="indicator icon-arrow left" rendered="{!IF(AND(lPageNumbers.size <> 0,lPageNumbers[0]!=1),true,false)}" action="{!PreviousPageSeries}" rerender="Listcontent,PaginationPanel"/>
                                <apex:repeat value="{!lPageNumbers}" var="obj">
                                    <apex:commandlink styleClass="{!if(obj==cProjectListCntlr.pagenumber,'indicator current','indicator')}" value="{!obj}" action="{!GoToPageNumber}" rerender="PaginationPanel">
                                        <apex:param name="{!obj}" value="{!obj}" assignTo="{!iPageNumber}" />
                                    </apex:commandlink>
                                </apex:repeat>
                                <apex:commandlink styleClass="indicator icon-arrow right" action="{!NextPageSeries}" rendered="{!IF(AND(lPageNumbers.size <> 0,dPageCount > lPageNumbers[lPageNumbers.size-1]),true,false)}" rerender="Listcontent,PaginationPanel" />
                            </apex:actionregion>
                        </div>
                    </div>
                    </apex:outputPanel>
                    <c:DRDP_FooterComponent />
                </apex:outputpanel>
                   
            </div>
                </apex:form> 
        </div>
</apex:page>